/*!
 * Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW)
 * www.tbs.gc.ca/ws-nw/wet-boew/terms / www.sct.gc.ca/ws-nw/wet-boew/conditions
 */
(function(a){a.fn.datalist=function(){return a(this).each(function(e){var f=a(this),i=a("#"+f.attr("list")),d,j,c=[],g,h,b;g=function(m){var k=m.toLowerCase(),l=j.filter(function(){var o=a(this),n=o.find("span.al-value").html();if(n.length===0){n=o.find("span.al-label").html()}return(k.length===0||n.toLowerCase().indexOf(k)===0)});j.not(l).addClass("al-hide");l.removeClass("al-hide");if(l.length!==0){d.removeClass("al-hide");f.attr("aria-expanded","true")}else{d.addClass("al-hide");f.attr("aria-expanded","false")}};h=function(){b.css("min-width",f.innerWidth());if(pe.ie<8){d.css("top",f.innerHeight()+13)}};pe.resize(h);i.find("option").each(function(n){var m=a(this),l=m.attr("value"),k=m.attr("label");if(l==="undefined"){l=m.text()}c.push('<li class="al-hide al-option" tabindex="-1" id="al-option-'+e+"-"+n+'"><span class="al-value">'+(l!=="undefined"?l:"")+'</span><span class="al-label">'+(k!=="undefined"?k:"")+"</span></li>")});f.attr({role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":"wb-autolist-"+e}).wrap('<div class="wb-al-container"/>');b=f.parent().css("min-width",f.innerWidth());d=a('<ul role="listbox" id="wb-autolist-'+e+'" class="wb-autolist al-hide">'+c.join("")+"</ul>");j=d.find("li");f.after(d);if(pe.ie<8){d.css("top",f.innerHeight()+13)}f.on("keyup keydown click vclick",function(n){var m=n.type,k=n.keyCode,l;if(m==="keyup"){if(!(n.ctrlKey||n.altKey||n.metaKey)){if((k>47&&k<58)||(k>64&&k<91)||k===32||k===8){g(f.val())}}}else{if(m==="keydown"){if(!(n.ctrlKey||n.metaKey)){if(!n.altKey&&f.attr("aria-expanded")==="true"){if(k===9||k===27){g("~!!@@#$");f.removeAttr("aria-activedescendent");if(k===27){return false}}else{if(k===38){l=j.filter(":not(.al-hide)").last();pe.focus(l);f.attr("aria-activedescendent",l.attr("id"));return false}else{if(k===40){l=j.filter(":not(.al-hide)").eq(0).last();pe.focus(l);f.attr("aria-activedescendent",l.attr("id"));return false}else{if(k===38||k===40){g("");return false}}}}}else{if(k===38||k===40){g("");return false}}}}else{if(m==="click"||m==="vclick"){if(f.attr("aria-expanded")==="true"){g("~!!@@#$")}else{g("")}return false}}}});d.on("keyup keydown click vclick","li, span",function(p){var m=p.type,k=p.keyCode,o=a(p.target),l,q=f.val(),n;if(m==="keyup"){if(!(p.ctrlKey||p.altKey||p.metaKey)){if((k>47&&k<58)||(k>64&&k<91)||k===32||k===8){pe.focus(f);g(f.val())}else{if(k===8&&f.val().length>0){f.val(q.substring(0,q.length-1));pe.focus(f);g(f.val())}}}}else{if(m==="keydown"){if(!(p.ctrlKey||p.altKey||p.metaKey)){if(k===13){n=o.find("span.al-value").html();if(n.length===0){n=o.find("span.al-label").html()}f.val(n);pe.focus(f);g("~!!@@#$");return false}else{if(k===9||k===27){pe.focus(f);g("~!!@@#$");f.removeAttr("aria-activedescendent");if(k===27){return false}}else{if(k===38){l=o.prev();if(l.length>0){pe.focus(l);f.attr("aria-activedescendent",l.attr("id"))}else{l=j.last();pe.focus(l);f.attr("aria-activedescendent",l.attr("id"))}return false}else{if(k===40){l=o.next();if(l.length>0){pe.focus(l);f.attr("aria-activedescendent",l.attr("id"))}else{l=j.eq(0);pe.focus(l);f.attr("aria-activedescendent",l.attr("id"))}return false}else{if(k===38||k===40){g("");return false}}}}}}}else{if(m==="click"||m==="vclick"){if(!o.hasClass("al-option")){o=o.parent()}n=o.find("span.al-value").html();if(n.length===0){n=o.find("span.al-label").html()}f.val(n);pe.focus(f);g("~!!@@#$");return false}}}});a(document).on("click touchstart",function(){if(f.attr("aria-expanded")==="true"){g("~!!@@#$");f.removeAttr("aria-activedescendent")}})})};a("input[list]").datalist()}(jQuery));